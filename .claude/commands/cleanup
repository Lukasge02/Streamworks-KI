#!/bin/bash

# Cleanup Development Environment - Reset and clear context
echo "ðŸ§¹ Cleaning up development environment..."

echo ""
echo "ðŸ›‘ Step 1: Stopping development servers..."
pkill -f "uvicorn main:app" 2>/dev/null && echo "   âœ… Backend stopped"
pkill -f "next dev" 2>/dev/null && echo "   âœ… Frontend stopped"
pkill -f "npm run dev" 2>/dev/null

echo ""
echo "ðŸ—‚ï¸ Step 2: Cleaning build artifacts..."
rm -rf frontend/.next/cache 2>/dev/null && echo "   âœ… Next.js cache cleared"
rm -rf frontend/node_modules/.cache 2>/dev/null && echo "   âœ… Node modules cache cleared"
find backend -name "*.pyc" -delete 2>/dev/null && echo "   âœ… Python cache files removed"
find backend -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null && echo "   âœ… Python cache directories removed"

echo ""
echo "ðŸ“‹ Step 3: Showing current port usage..."
echo "   Port 3000 (Frontend): $(lsof -i :3000 | wc -l | xargs) processes"
echo "   Port 8000 (Backend):  $(lsof -i :8000 | wc -l | xargs) processes"

echo ""
echo "ðŸ”„ Step 4: Claude Code context management..."
echo "   ðŸ’¡ Use '/clear' to reset Claude Code context after cleanup"
echo "   ðŸ’¡ Use '/dev-start' to restart development environment"

echo ""
echo "âœ… Cleanup complete!"